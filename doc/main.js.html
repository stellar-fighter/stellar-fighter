<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: main.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import './main.scss';
import {Game} from './game';
import {State, PlayState, GameOverState} from './states';
import $ from 'jquery';
import 'jquery-modal/jquery.modal';
import jqery_modal_css from 'jquery-modal/jquery.modal.css';
import page from 'page';
/**
 * Set new game with new Game object
 */
function main() {
  const game = new Game();
  let animId = null;
  let canvas = null;
  let controls = null;
  let normalStart = false;
  /*
  const level = [{x: 0, y: -1000, type: 's-fighter'}, {x: 1000, y: -2000, type: 's-fighter', player: true}];
  level.sort((a, b) => {
    return b.y - a.y;
  });
  */

  function step(timeStamp) {
    if(animId) {
      game.setTime(timeStamp);
      game.update();
      game.render();
      animId = requestAnimationFrame(step);
    }
  }

  /**
   * Push new PlayState object to Game object
   */
  function play() {
    if(animId === null) {
      game.flushStates();
      game.pushState(new PlayState({game, running: true, canvas}));
      animId = requestAnimationFrame(step);
    }
  }

  /**
   * Resize canvas funcion that will be called when resize event happens
   */
  function resizeCanvas() {
    canvas = document.getElementById('main-canvas');
    controls = document.getElementById('controls');
    canvas.width = 9;
    canvas.height = 16 * 0.95;
    if(canvas.height / canvas.width >= window.innerHeight / window.innerWidth) {
      const newHeight = window.innerHeight * 0.95;
      canvas.width = newHeight * canvas.width / canvas.height;
      canvas.height = newHeight;
    } else {
      const newWidth = window.innerWidth;
      canvas.height = newWidth * canvas.height / canvas.width;
      canvas.width = newWidth;
    }
    const $canvas = $(canvas);
    const $controls = $(controls);
    $controls.css('top', canvas.height);
    $controls.css('height', canvas.height * 0.05 / 0.95);
    $controls.css('width', canvas.width);
  }

  function unfocusElement() {
    document.activeElement.blur();
  }

  /**
   * Initialize by mapping source code to appropriate page
   */
  function init() {
    page('/main', (ctx, next) => {
      $('body').empty();
      $.get('./page/main.html', (res) => {
        $('body').html(res);
        $('#play-button').click((event) => page('/play'));
        $('#scores-button').click((event) => page('/scores'));
      });
      normalStart = true;
    });
    page('/scores', (ctx, next) => {
      if(!normalStart) return;
      $.get('./page/play.html', (res) => {
        $('body').html(res);
        $('#button-menu').click((event) => {
          game.state.running = false;
          event.preventDefault();
          this.blur();
          $('#button-menu-close').click((event) => {
            game.state.running = true;
            $.modal.close();
          });
          $('#button-to-main').click((event) => {
            event.preventDefault();
            this.blur();
            page("/main");
          });
          $('#menu').modal({
            escapeClose: false,
            clickClose: false,
            showClose: false
          });
        });
        addEventListener('resize', resizeCanvas);
        addEventListener('focus', unfocusElement);
        resizeCanvas();
        if(animId === null) {
          game.flushStates();
          game.pushState(new GameOverState({game, running: true, canvas}));
          animId = requestAnimationFrame(step);
        }
      });
    });
    page.exit('/scores', (ctx, next) => {
      removeEventListener('resize', resizeCanvas);
      removeEventListener('focus', unfocusElement);
      cancelAnimationFrame(animId);
      animId = null;
      next();
    });
    page('/play', (ctx, next) => {
      if(!normalStart) return;
      $('body').empty();
      $.get('./page/play.html', (res) => {
        $('body').html(res);
        $('#button-menu').click((event) => {
          game.state.running = false;
          event.preventDefault();
          this.blur();
          $('#button-menu-close').click((event) => {
            game.state.running = true;
            $.modal.close();
          });
          $('#button-to-main').click((event) => {
            event.preventDefault();
            this.blur();
            page("/main");
          });
          $('#menu').modal({
            escapeClose: false,
            clickClose: false,
            showClose: false
          });
        });
        addEventListener('resize', resizeCanvas);
        addEventListener('focus', unfocusElement);
        resizeCanvas();
        play();
      });
    });
    page.exit('/play', (ctx, next) => {
      removeEventListener('resize', resizeCanvas);
      removeEventListener('focus', unfocusElement);
      cancelAnimationFrame(animId);
      animId = null;
      next();
    });
    // page('*', () => console.log('middleware'));
    page({hashbang: true});
    page.stop();
    page('/main');

  }
  addEventListener('load', init);
}

main();
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Alien001.html">Alien001</a></li><li><a href="Alien002.html">Alien002</a></li><li><a href="AssetMan.html">AssetMan</a></li><li><a href="Background.html">Background</a></li><li><a href="Bullet001.html">Bullet001</a></li><li><a href="Camera.html">Camera</a></li><li><a href="CamOutComp.html">CamOutComp</a></li><li><a href="CamOutSystem.html">CamOutSystem</a></li><li><a href="CollComp.html">CollComp</a></li><li><a href="CollSystem.html">CollSystem</a></li><li><a href="Comp.html">Comp</a></li><li><a href="CtrlComp.html">CtrlComp</a></li><li><a href="Entity.html">Entity</a></li><li><a href="EntityMan.html">EntityMan</a></li><li><a href="Fighter001.html">Fighter001</a></li><li><a href="Game.html">Game</a></li><li><a href="GameOverState.html">GameOverState</a></li><li><a href="HpComp.html">HpComp</a></li><li><a href="HpDisplay.html">HpDisplay</a></li><li><a href="HpSystem.html">HpSystem</a></li><li><a href="Item001.html">Item001</a></li><li><a href="MovComp.html">MovComp</a></li><li><a href="MovSystem.html">MovSystem</a></li><li><a href="PlayerSystem.html">PlayerSystem</a></li><li><a href="PlayState.html">PlayState</a></li><li><a href="PosComp.html">PosComp</a></li><li><a href="SceneNode.html">SceneNode</a></li><li><a href="ScoreComp.html">ScoreComp</a></li><li><a href="ScoreDisplay.html">ScoreDisplay</a></li><li><a href="ShootingComp.html">ShootingComp</a></li><li><a href="ShootingSystem.html">ShootingSystem</a></li><li><a href="SizeComp.html">SizeComp</a></li><li><a href="Sprite.html">Sprite</a></li><li><a href="State.html">State</a></li><li><a href="System.html">System</a></li><li><a href="TeamComp.html">TeamComp</a></li><li><a href="Timer.html">Timer</a></li><li><a href="Vec.html">Vec</a></li><li><a href="VisComp.html">VisComp</a></li></ul><h3>Global</h3><ul><li><a href="global.html#main">main</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.2</a> on Sat Jun 08 2019 19:07:45 GMT+0900 (KST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
